<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="robots" content="noindex,nofollow" />
  <title>Submit Car Loan – Dev RealRates</title>
  <style>
    body { font-family: system-ui, Arial; margin: 24px; max-width: 720px; }
    h1 { margin: 0 0 12px; }
    form { display: flex; flex-direction: column; gap: 14px; }
    label { display: flex; flex-direction: column; gap: 6px; }
    select, input { padding: 10px; font-size: 14px; }
    .row { display:flex; gap:12px; }
    .row > label { flex:1; }
    .muted { color:#666; font-size: 12px; }
    button { padding: 12px; font-size: 14px; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Submit a Car Loan</h1>
  <div class="muted">All fields are dropdowns except lender and rate. Keep it simple.</div>

  <form id="loanForm">
    <!-- Loan outcome -->
    <label>
      Lender (as shown on offer)
      <input name="lender" required maxlength="60" placeholder="e.g. ANZ, Westpac" />
    </label>

    <label>
      Interest rate (%) offered
      <input name="interestRate" type="number" step="0.01" required min="0.01" max="49.99" placeholder="e.g. 12.50" />
    </label>

    <!-- Key drivers -->
    <div class="row">
      <label>
        State
        <select name="state" required>
          <option value="VIC">VIC</option>
          <option value="NSW">NSW</option>
          <option value="QLD">QLD</option>
          <option value="SA">SA</option>
          <option value="WA">WA</option>
          <option value="TAS">TAS</option>
          <option value="ACT">ACT</option>
          <option value="NT">NT</option>
        </select>
      </label>

      <label>
        Application channel
        <select name="applicationChannel" required>
          <option value="online">Online</option>
          <option value="branch">Branch</option>
          <option value="broker">Broker</option>
          <option value="dealer">Dealer</option>
        </select>
      </label>
    </div>

    <label>
      Income (gross, excl super) – band
      <select name="incomeBand" required>
        <option value="lt_40000">&lt; $40k</option>
        <option value="40000-49999">$40k–49,999</option>
        <option value="50000-59999">$50k–59,999</option>
        <option value="60000-69999">$60k–69,999</option>
        <option value="70000-79999">$70k–79,999</option>
        <option value="80000-89999">$80k–89,999</option>
        <option value="90000-99999">$90k–99,999</option>
        <option value="100000-109999">$100k–109,999</option>
        <option value="110000-119999">$110k–119,999</option>
        <option value="120000-129999">$120k–129,999</option>
        <option value="130000-149999">$130k–149,999</option>
        <option value="150000-179999">$150k–179,999</option>
        <option value="180000-219999">$180k–219,999</option>
        <option value="220000_plus">$220k+</option>
      </select>
    </label>

    <label>
      Employment status / stability
      <select name="employmentStatus" required>
        <option value="ft_1y_plus">Full-time (1+ year)</option>
        <option value="ft_under_1y">Full-time (&lt; 1 year)</option>
        <option value="pt">Part-time</option>
        <option value="casual">Casual</option>
        <option value="self_employed_1y_plus">Self-employed (1+ year)</option>
        <option value="self_employed_under_1y">Self-employed (&lt; 1 year)</option>
        <option value="unemployed">Unemployed</option>
      </select>
    </label>

    <label>
      Age band
      <select name="ageBand" required>
        <option value="18-24">18–24</option>
        <option value="25-34">25–34</option>
        <option value="35-44">35–44</option>
        <option value="45-54">45–54</option>
        <option value="55-64">55–64</option>
        <option value="65_plus">65+</option>
      </select>
    </label>

    <label>
      Housing status
      <select name="housingStatus" id="housingStatus" required>
        <option value="owner_mortgage">Owner (mortgage)</option>
        <option value="owner_outright">Owner (outright)</option>
        <option value="renting">Renting</option>
        <option value="living_with_family">Living with family</option>
        <option value="other">Other</option>
      </select>
    </label>

    <label id="rentField" class="hidden">
      Monthly rent (band)
      <select name="rentPaymentBand">
        <option value="lt_1000">&lt; $1,000</option>
        <option value="1000-1499">$1,000–1,499</option>
        <option value="1500-1999">$1,500–1,999</option>
        <option value="2000-2499">$2,000–2,499</option>
        <option value="2500-2999">$2,500–2,999</option>
        <option value="3000-3999">$3,000–3,999</option>
        <option value="4000_plus">$4,000+</option>
      </select>
    </label>

    <label id="mortgageField" class="hidden">
      Monthly mortgage repayment (band)
      <select name="mortgagePaymentBand">
        <option value="lt_1000">&lt; $1,000</option>
        <option value="1000-1499">$1,000–1,499</option>
        <option value="1500-1999">$1,500–1,999</option>
        <option value="2000-2499">$2,000–2,499</option>
        <option value="2500-2999">$2,500–2,999</option>
        <option value="3000-3999">$3,000–3,999</option>
        <option value="4000_plus">$4,000+</option>
      </select>
    </label>

    <label>
      Dependents
      <select name="dependents" required>
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5_plus">5+</option>
      </select>
    </label>

    <label>
      Existing debt obligations (monthly repayments)
      <select name="monthlyDebtRepaymentsBand" required>
        <option value="0">$0</option>
        <option value="1-199">$1–199</option>
        <option value="200-499">$200–499</option>
        <option value="500-999">$500–999</option>
        <option value="1000-1499">$1,000–1,499</option>
        <option value="1500-2499">$1,500–2,499</option>
        <option value="2500_plus">$2,500+</option>
      </select>
    </label>

    <label>
      Savings / liquid assets
      <select name="liquidAssetsBand" required>
        <option value="lt_1000">&lt; $1,000</option>
        <option value="1000-4999">$1,000–4,999</option>
        <option value="5000-9999">$5,000–9,999</option>
        <option value="10000-19999">$10,000–19,999</option>
        <option value="20000-49999">$20,000–49,999</option>
        <option value="50000-99999">$50,000–99,999</option>
        <option value="100000_plus">$100,000+</option>
      </select>
    </label>

    <!-- Loan features -->
    <label>
      Loan amount (band)
      <select name="loanAmountBand" required>
        <option value="lt_5000">&lt; $5,000</option>
        <option value="5000-9999">$5,000–9,999</option>
        <option value="10000-14999">$10,000–14,999</option>
        <option value="15000-19999">$15,000–19,999</option>
        <option value="20000-29999">$20,000–29,999</option>
        <option value="30000-39999">$30,000–39,999</option>
        <option value="40000-49999">$40,000–49,999</option>
        <option value="50000_plus">$50,000+</option>
      </select>
    </label>

    <label>
      Loan purpose
      <select name="loanPurpose" required>
        <option value="car_new">Car – new</option>
        <option value="car_used">Car – used</option>
        <option value="personal_debt_consolidation">Debt consolidation</option>
        <option value="personal_wedding">Wedding</option>
        <option value="personal_medical">Medical</option>
        <option value="personal_travel">Travel</option>
        <option value="personal_home_improvement">Home improvement</option>
        <option value="other">Other</option>
      </select>
    </label>

    <label>
      Loan term (months)
      <select name="loanTermMonths" required>
        <option value="12">12</option>
        <option value="24">24</option>
        <option value="36">36</option>
        <option value="48">48</option>
        <option value="60">60</option>
        <option value="72">72</option>
        <option value="84">84</option>
      </select>
    </label>

    <div class="row">
      <label>
        Guarantor
        <select name="guarantor" required>
          <option value="none">None</option>
          <option value="yes">Yes</option>
        </select>
      </label>

      <label>
        Deposit size (%)
        <select name="depositPercentBand" required>
          <option value="0">0%</option>
          <option value="1-9">1–9%</option>
          <option value="10-19">10–19%</option>
          <option value="20-29">20–29%</option>
          <option value="30_plus">30%+</option>
        </select>
      </label>
    </div>

    <label>
      Vehicle age (band)
      <select name="vehicleAgeBand" required>
        <option value="new">New</option>
        <option value="1-3">1–3 years</option>
        <option value="4-7">4–7 years</option>
        <option value="8-12">8–12 years</option>
        <option value="13_plus">13+ years</option>
      </select>
    </label>

    <button type="submit">Submit</button>
  </form>

  <script>
    // Conditional rent/mortgage
    const housing = document.getElementById("housingStatus");
    const rentField = document.getElementById("rentField");
    const mortgageField = document.getElementById("mortgageField");

    function syncHousing() {
      const v = housing.value;
      rentField.classList.toggle("hidden", v !== "renting");
      mortgageField.classList.toggle("hidden", v !== "owner_mortgage");
    }
    housing.addEventListener("change", syncHousing);
    syncHousing();

    // SUBMIT LOGIC (bottom)
    document.getElementById("loanForm").addEventListener("submit", async (e) => {
      e.preventDefault(); // critical

      const form = e.target;

      const payload = {
        // outcome
        lender: form.lender.value,
        interestRate: Number(form.interestRate.value),

        // key drivers
        state: form.state.value,
        applicationChannel: form.applicationChannel.value,

        // personal profile
        incomeBand: form.incomeBand.value,
        employmentStatus: form.employmentStatus.value,
        ageBand: form.ageBand.value,
        housingStatus: form.housingStatus.value,
        rentPaymentBand: form.rentPaymentBand?.value || null,
        mortgagePaymentBand: form.mortgagePaymentBand?.value || null,
        dependents: form.dependents.value,
        monthlyDebtRepaymentsBand: form.monthlyDebtRepaymentsBand.value,
        liquidAssetsBand: form.liquidAssetsBand.value,

        // loan features
        loanAmountBand: form.loanAmountBand.value,
        loanPurpose: form.loanPurpose.value,
        loanTermMonths: form.loanTermMonths.value,
        guarantor: form.guarantor.value,
        depositPercentBand: form.depositPercentBand.value,
        vehicleAgeBand: form.vehicleAgeBand.value
      };

      try {
        const res = await fetch("/api/submit-car-loan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const text = await res.text();
          alert("Submit failed: " + text);
          return;
        }

        alert("Submitted successfully");
        form.reset();
        syncHousing();

      } catch (err) {
        alert("Network error");
        console.error(err);
      }
    });
  </script>
</body>
</html>
